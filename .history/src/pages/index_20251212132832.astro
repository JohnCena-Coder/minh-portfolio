---
import MainLayout from '../layouts/MainLayout.astro';
import { supabase } from '../lib/supabase';

// Lấy danh sách dự án từ Database, chỉ lấy cái nào đang "Visible"
const { data: projects, error } = await supabase
  .from('projects')
  .select('*')
  .eq('status', 'visible')
  .order('created_at', { ascending: false });

if (error) console.error("Lỗi lấy dữ liệu:", error);
---

<MainLayout title="Minh. | Creative Showcase">
  
  {/* Tiêu đề trang (Optional) */}
  <div class="mb-8 sm:mb-12 text-center fade-in">
    <h1 class="text-3xl sm:text-4xl font-serif mb-2">Creative Showcase</h1>
    <p class="text-gray-400 text-sm font-light">Latest works & visual stories</p>
  </div>

  {/* LƯỚI SẢN PHẨM */}
  {/* Mobile: grid-cols-2 (2 cột) | PC: md:grid-cols-4 (4 cột) */}
  <div class="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-6">
    
    {projects && projects.map((project) => (
      <a href={`/p/${project.id}`} class="group block fade-in">
        
        {/* Khung Ảnh */}
        <div class="relative aspect-[3/4] overflow-hidden bg-gray-100 mb-2 sm:mb-3">
          {project.thumbnail_url ? (
            <img 
              src={project.thumbnail_url} 
              alt={project.title} 
              class="w-full h-full object-cover transition duration-700 ease-out group-hover:scale-105"
              loading="lazy"
            />
          ) : (
            <div class="w-full h-full flex items-center justify-center text-gray-300">No Image</div>
          )}
          
          {/* Lớp phủ mờ khi rê chuột trên PC */}
          <div class="absolute inset-0 bg-black/0 group-hover:bg-black/5 transition duration-300"></div>
        </div>

        {/* Thông tin */}
        <div class="px-1">
          <h3 class="text-sm sm:text-base font-bold text-gray-900 leading-tight group-hover:underline decoration-1 underline-offset-4">
            {project.title}
          </h3>
          <p class="text-xs sm:text-sm text-gray-500 mt-1 font-light uppercase tracking-wide">
            {project.category || 'Photography'}
          </p>
        </div>

      </a>
    ))}

  </div>

  {/* Nếu chưa có ảnh nào */}
  {(!projects || projects.length === 0) && (
    <div class="text-center py-20 text-gray-400 font-light">
      <p>Chưa có dự án nào được đăng.</p>
      <p class="text-sm mt-2">Hãy vào Admin để upload ảnh mới.</p>
    </div>
  )}

</MainLayout>

<style>
  /* Hiệu ứng xuất hiện nhẹ nhàng */
  .fade-in {
    animation: fadeIn 0.8s ease-out forwards;
    opacity: 0;
  }
  @keyframes fadeIn {
    to { opacity: 1; }
  }
  /* Stagger animation cho từng item (tự động trễ nhịp) */
  .fade-in:nth-child(1) { animation-delay: 0.1s; }
  .fade-in:nth-child(2) { animation-delay: 0.2s; }
  .fade-in:nth-child(3) { animation-delay: 0.3s; }
  .fade-in:nth-child(4) { animation-delay: 0.4s; }
  /* ... thêm nếu cần, nhưng cơ bản là đủ đẹp */
</style>